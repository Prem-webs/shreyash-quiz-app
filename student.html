<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Quiz</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen">

<div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-xl">
<h1 class="text-2xl font-bold mb-4 text-center">Quiz</h1>

<button id="startBtn" class="bg-green-600 text-white px-4 py-2 rounded w-full">
Start Quiz
</button>

<div id="quiz" class="hidden mt-4">
<p id="question"></p>
<div id="options" class="space-y-2 mt-3"></div>
<button id="next" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded w-full">
Next
</button>
</div>

</div>

<script>
const API = location.origin;
const sessionId = new URLSearchParams(location.search).get('sessionId');
let questions=[], index=0, answers={}, attemptId=null;

document.getElementById('startBtn').onclick = async () => {
    const res = await fetch(`${API}/student/start-quiz`, {
        method:'POST',
        headers:{'x-session-id':sessionId}
    });
    const data = await res.json();
    attemptId = data.attemptId;

    const q = await fetch(`${API}/questions?ids=${data.questionIds.join(',')}`, {
        headers:{'x-session-id':sessionId}
    });
    questions = await q.json();

    document.getElementById('startBtn').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    render();
};

function render(){
    const q = questions[index];
    document.getElementById('question').innerText = q.question_text;
    const opt = document.getElementById('options');
    opt.innerHTML='';
    ['A','B','C','D'].forEach(k=>{
        const b=document.createElement('button');
        b.innerText=q[`option_${k.toLowerCase()}`];
        b.className='block w-full border p-2';
        b.onclick=()=>answers[q.id]=k;
        opt.appendChild(b);
    });
}

document.getElementById('next').onclick = async ()=>{
    if(index < questions.length-1){
        index++; render();
    }else{
        await fetch(`${API}/student/submit-answers`,{
            method:'POST',
            headers:{'Content-Type':'application/json','x-session-id':sessionId},
            body:JSON.stringify({attemptId,answers})
        });

        await fetch(`${API}/logout`,{
            method:'POST',
            headers:{'x-session-id':sessionId}
        });

        alert('Quiz submitted successfully');
        location.href = '/';
    }
};
</script>
</body>
</html>
